<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>term terminal</title>
    <style type="text/css">
    .terminal {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        float: none;
        font-family: Consolas, monospace;
        font-size: 12px;
        color: rgb(240, 240, 240);
        background: #383734 !important;
        padding: 3px;
        border: none !important;
    }

    .terminal-cursor {
        color: #000;
        background: #f0f0f0;
    }
    </style>
</head>

<body>
    <div id="terminal"></div>
    <script src="/term.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
    window.addEventListener('load', function() {
        var socket = io.connect();
        var terminal = document.getElementById('terminal');
        var data = '';

        socket.on('connect', function() {
            var handler = function(thunk) {
                term.write(thunk);
                data += thunk.trim();
            };
            var term = window.term = new Terminal({
                cols: 200,
                rows: 100,
                useStyle: true,
                screenKeys: true
            });

            // term.on('data', function(data) {
            //     socket.emit('data', data);
            // });
            term.on('data', handler);

            term.on('title', function(title) {
                document.title = title;
            });

            term.on('key', function(key, e) {
                if('\r' == key) {
                    if(data) {
                        socket.emit('input', data);
                        data = '';
                    } else {
                        term.insertLines([1]);
                    }
                }
            });

            term.open(terminal);
            term.write('\x1b[31mWELCOME!\x1b[m\r\n');

            socket.on('data', function(data) {
                term.writeln(data);
            });

            socket.on('output', function(data) {
                data = data.trim();
                if (data) term.writeln('\n' + data);
            });

            socket.on('disconnect', function() {
                term.destroy();
            });
        });
    }, false);
    </script>
</body>

</html>
